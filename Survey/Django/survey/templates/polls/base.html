{% load bootstrap3 %}
{% load staticfiles %}

<!DOCTYPE html>
<html>
  <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  var csrf_token = "{% csrf_token %}";
  $(function() {
    $('#sortable,ol').sortable({
        placeholder: 'ui-state-highlight',
        connectWith: '.connect_lists',
        receive: function(event, ui) {
          var $this = $(this);
          if ($this.children('li').length > 10 && $this.attr('id') != "sortable") {
            console.log('Only one per list!');
            $(ui.sender).sortable('cancel');
          }
        }
    });
	
	
	var ajaxFunction = function(event, ui){
	  var results = $('#sortable-result').children();
      var resArray = [];
      for (var i = 0; i < results.length; i++) {
        resArray.push(results[i].id);
      }
			$.ajax({
			data: {'resarray[]': resArray},
			type: 'POST',
			url: '/survey/{{ questiongroup_id }}/{{ step }}/',
			async: false, 
			});
	}
	
	function nextClick(event, ui){
		var results = $('#sortable-result').children();
		if (results.length == 10 && {{step}} < 10){
			ajaxFunction(event, ui);
			document.location.href="{% url 'survey' questiongroup_id step %}";
		}		
		else if(results.length < 10){
			alert("You need to have 10 selected items");
		}
		else if ({{step}} == 10){
			document.location.href="{% url 'Survey finished' %}";
		}
	}
	
	document.getElementById("next").onclick = function(event, ui) {nextClick(event, ui)};
	/**
    $('#sortable-result').sortable({
        receive: function(event, ui) {
			ajaxFunction(event, ui);
        }
    });
	$('#sortable-result').sortable({
        stop: function(event, ui) {
			ajaxFunction(event, ui);
          }
    });
	**/
		
});

  </script>

  {% bootstrap_css %}
  {% bootstrap_javascript %}
  <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,500,300,100' rel='stylesheet' type='text/css'>
    <title>Group Recommendation Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-nav-bar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
        </button> 
        <a class="navbar-brand" href="{% url 'index' %}">Survey</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="main-nav-bar">
        <ul class="nav navbar-nav">
          <li class="{% if nav_active == 'home' %} active {% endif %}"><a href="{% url 'index' %}">Home</a></li>
          <li class="{% if nav_active == 'survey' %} active {% endif %}"><a href="{% url 'survey' questiongroup_id step %}">Survey</a></li>
        </ul>
      </div>
    </div>
  </nav>

  {% block content %}
  {% endblock content %}
  </body>
</html>

